{% extends 'base.html' %} {% block title %}Media Ratings{% endblock title %}
{%block content %}
<style>
  .scoreboard-container {
    height: 400px;
    border-style: solid;
    border-color: darkgrey;
    border-width: 5px;
    border-radius: 20px;
    background-color: darkgrey;
    color: white;
  }

  .scoreboard-header {
    text-align: center;
    text-decoration: underline;
    width: 100%;
    height: 25%;
  }

  h2 {
    width: 30%;
    margin: 0 35%;
    padding: 10px 0;
    background-color: rgb(54, 54, 54);
    border-radius: 30px;
  }

  h3 {
    width: 30%;
    margin: 0 35%;
    color: white;
  }

  .scoreboard-content {
    width: 100%;
    height: 75%;
  }

  .score-block {
    width: 30%;
    height: 150px;
    text-align: center;
    border-radius: 10px;
  }

  #metacritic-block {
    background-color: #6c3;
  }
  #imdb-block {
    background-color: #f5c518;
  }

  #rottentomatoes-block {
    background-color: #fa320a;
  }

  .score-block-header {
    text-decoration: underline;
    font-weight: bold;
    font-size: 1.3rem;
  }

  .score-block-content {
  }

  .score-block-unit {
    margin: 0 12%;
  }

  .score-block-unit-header {
    width: 100%;
    height: 50px;
    text-decoration: underline;
    font-weight: bold;
  }

  .score-block-unit-score {
    margin-top: 10px;
    max-width: 100px;
    padding: 5px;
    font-weight: bold;
    font-size: 1.6rem;
    background-color: rgb(54, 54, 54);
    border-radius: 15px;
  }

  #imdb-score {
    font-size: 1.5rem;
  }

  i {
    animation: spin infinite 1s linear;
  }

  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
</style>

<div class="row justify-content-center">
  <div class="scoreboard-container col-md-9" data-test="canvas-container">
    <div class="scoreboard-header">
      <h2 id="media-title" data-test="media-title">{{ media_title }}</h2>
    </div>
    <div class="scoreboard-content d-flex justify-content-evenly">
      <div class="score-block" id="metacritic-block">
        <div
          class="score-block-header"
          id="metacritic-header"
          data-test="metacritic-header"
        >
          Metacritic
        </div>
        <div class="score-block-content d-flex justify-content-evenly">
          <div class="score-block-unit">
            <div
              class="score-block-unit-header"
              id="metascore-header"
              data-test="metascore-header"
            >
              Metascore
            </div>
            <div
              class="score-block-unit-score"
              id="metascore-value"
              data-test="metascore-value"
            >
              <i class="fas fa-spinner"></i>
            </div>
          </div>
          <div class="score-block-unit">
            <div
              class="score-block-unit-header"
              id="user-score-header"
              data-test="user-score-header"
            >
              Userscore
            </div>
            <div
              class="score-block-unit-score"
              id="user-score-value"
              data-test="user-score-value"
            >
              <i class="fas fa-spinner"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="score-block" id="imdb-block">
        <div
          class="score-block-header"
          id="imdb-header"
          data-test="imdb-header"
        >
          IMDb
        </div>
        <div class="score-block-content d-flex justify-content-evenly">
          <div class="score-block-unit">
            <div class="score-block-unit-header"></div>
            <div
              class="score-block-unit-score"
              id="imdb-score"
              data-test="imdb-score-value"
            >
              <i class="fas fa-spinner"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="score-block" id="rottentomatoes-block">
        <div
          class="score-block-header"
          id="rottentomatoes-header"
          data-test="rottentomatoes-header"
        >
          Rottentomatoes
        </div>
        <div class="score-block-content d-flex justify-content-evenly">
          <div class="score-block-unit">
            <div
              class="score-block-unit-header"
              id="tomatometer-header"
              data-test="tomatometer-header"
            >
              Avg tomatometer
            </div>
            <div
              class="score-block-unit-score"
              id="tomatometer-value"
              data-test="tomatometer-value"
            >
              <i class="fas fa-spinner"></i>
            </div>
          </div>
          <div class="score-block-unit">
            <div
              class="score-block-unit-header"
              id="audience_score-header"
              data-test="audience_score-header"
            >
              Avg audience score
            </div>
            <div
              class="score-block-unit-score"
              id="audience_score-value"
              data-test="audience_score-value"
            >
              <i class="fas fa-spinner"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const fetchedData = fetch(
    "http://localhost:8000/fetch-score-data/?media={{ search_term }}",
    {
      method: "GET",
    }
  )
    .then((fetchedData) => {
      return fetchedData.json();
    })
    .then((agenciesData) => {
      addRatingAgencyValues(agenciesData);
    })
    .catch((error) => {
      console.error(error);
    });

  const addRatingAgencyValues = (agenciesData) => {
    for (const agency in agenciesData) {

      if (agency === "imdb") {
        const imdbScoreValueElem = document.getElementById(`${agency}-score`);
        if (imdbScoreValueElem) {
          imdbScoreValueElem.innerHTML = agenciesData[agency];
        } else {
          throw new Error(`Element with id: ${agency}-score not found!`);
        }
      } else {
        rtScoreValues = agenciesData["rt"];
        for (const rtScore in rtScoreValues) {
          const rtScoreValueElem = document.getElementById(`${rtScore}-value`);
          if (rtScoreValueElem) {
            rtScoreValueElem.innerHTML = rtScoreValues[rtScore];
          } else {
            throw new Error(`Element with id: ${rtScore}-value not found!`);
          }
        }
      }
    }
  };
</script>

{% endblock content %}
